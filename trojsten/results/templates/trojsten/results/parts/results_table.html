{% load utils %}
{% load mathfilters %}
{% load i18n %}

<div class="table-responsive">
<table class="table table-hover table-condensed results-table">
<thead>
<tr>
    <th class="text-right result-header result-rank">#</th>

    {% comment %}Translators: original: Meno{% endcomment %}
    <th class="result-header result-name">{% trans "Name" %}:</th>

    <th class="result-header result-year">
        {% comment %}Translators: original: Ročník{% endcomment %}
        {% trans 'Year' as text_year %}
        <abbr title="{{ text_year }}" data-toggle="tooltip" data-placement="top">{{ text_year.0|upper }}</abbr>
    </th>

    {% comment %}Translators: original: Škola{% endcomment %}
    <th class="result-header result-school">{% trans "School" %}</th>

    {% if has_previous_results %}
        <th class="result-header result-prev">

            {% comment %}Translators: original: Predchádzajúce série{% endcomment %}
            {% trans 'Previous rounds' as text_prev_rounds %}
            <abbr title="{{ text_prev_rounds }}" data-toggle="tooltip" data-placement="top">{{ text_prev_rounds.0|upper }}</abbr>
        </th>
    {% endif %}
    {% for task in tasks %}
        <th class="result-header result-task{% if task.integer_source_points %} result-task-integer{% endif %}">
            <a href="{% url 'task_statement' task_id=task.id %}" title="{{ task.name }}"
               data-toggle="tooltip" data-placement="top">
                {{ task.number }}
            </a>
        </th>
    {% endfor %}
    <th class="result-header result-sum"><strong>&sum;</strong></th>
</tr>
</thead>
{% for result in results %}
{% spaceless %}
<tr {% if user == result.user %}class="active"{% endif %}>
    <td class="text-right result-rank">
    {% ifchanged result.data.sum %}
        <strong>{{ result.data.rank }}. </strong>
    {% endifchanged %}
    {% if has_previous_results %}
        {% if not result.data.prev_rank %}
            <span class="text-info glyphicon glyphicon-asterisk"></span>
        {% elif result.data.rank < result.data.prev_rank %}
            <span class="text-success glyphicon glyphicon-chevron-up"
                  title="+{{ result.data.prev_rank|sub:result.data.rank }}"
                  data-toggle="tooltip" data-placement="top"></span>
        {% elif result.data.rank > result.data.prev_rank %}
            <span class="text-danger glyphicon glyphicon-chevron-down"
                  title="-{{ result.data.rank|sub:result.data.prev_rank }}"
                  data-toggle="tooltip" data-placement="top"></span>
        {% else %}
            <span class="text-muted glyphicon glyphicon-pushpin"></span>
        {% endif %}
    {% endif %}
    </td>
    <td class="result-name">{{ result.user.get_full_name }}</td>
    <td class="result-year">{{ result.user.school_year | school_year }}</td>
    <td class="result-school">
    {% if result.user.school.has_abbreviation %}
        <abbr title="{{ result.user.school.verbose_name }}" data-toggle="tooltip"
              data-placement="top">
            {{ result.user.school.abbreviation }}
        </abbr>
    {% else %}
        {{ result.user.school.verbose_name }}
    {% endif %}
    </td>
    {% if has_previous_results %}
        <td class="result-prev">{{ result.data.previous_rounds_points }}</td>
    {% endif %}
    {% for task in tasks %}
        <td class="result-task{% if task.integer_source_points %} result-task-integer{% endif %}">
        {% lookup_as result.data.tasks task.id as task_points %}
        {% if task_points.submitted %}
            <span data-toggle="tooltip" data-placement="top"
                  title="{% if task.description_points > 0 %}popis: {% if task_points.description_pending %}??{% else %}{{ task_points.description_points }}{% endif %}{% if task.source_points > 0 %} {% endif %}{% endif %}{% if task.source_points > 0 %}program: {{ task_points.source_points }}{% endif %}">
                {% if task_points.description_pending %}
                    ({{ task_points.sum }})
                {% else %}
                    {{ task_points.sum }}
                {% endif %}
            </span>
        {% endif %}
        </td>
    {% endfor %}

    <td class="result-sum"><strong>{{ result.data.sum }}</strong></td>
</tr>
{% endspaceless %}
{% empty %}
<tr>
    {% comment %}Translators: original: Žiadne submity{% endcomment %}
    <td colspan="{{ tasks | length | add:5 }}">{% trans "No submits" %}</td>
</tr>
{% endfor %}
</table>
</div>
